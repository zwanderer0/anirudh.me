!function(){"use strict";var e={d:function(t,a){for(var n in a)e.o(a,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:a[n]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r:function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{init:function(){return zt},registerVariableType:function(){return z},registerVariableTypes:function(){return xt}});var a=window.elementorV2.editor,n=window.elementorV2.editorEditingPanel,r=window.elementorV2.editorPanels,o=window.elementorV2.editorProps,l=window.React,i=window.elementorV2.editorUi,s=window.elementorV2.editorV1Adapters,c=window.elementorV2.icons,u=window.elementorV2.ui,d=window.wp.i18n,m=window.elementorV2.mixpanel;const p=({varType:e,controlPath:t,action:a})=>{const{dispatchEvent:n,config:r}=(0,m.getMixpanel)();if(!r?.names?.variables?.[a])return;const o=r.names.variables[a];n?.(o,{location:r?.locations?.variables||"",secondaryLocation:r?.secondaryLocations?.variablesPopover||"",trigger:r?.triggers?.click||"",var_type:e,control_path:t,action_type:o})},b=({action:e,varType:t,controlPath:a})=>{const{dispatchEvent:n,config:r}=(0,m.getMixpanel)();if(!r?.names?.variables?.[e])return;const o=r.names.variables[e],l={location:r?.locations?.variablesManager||"",trigger:r?.triggers?.click||"",action_type:o};t&&(l.var_type=t),a&&(l.style_control_path=a),n?.(o,l)},h={MISSING_VARIABLE_NAME:(0,d.__)("Give your variable a name.","elementor"),MISSING_VARIABLE_VALUE:(0,d.__)("Add a value to complete your variable.","elementor"),INVALID_CHARACTERS:(0,d.__)("Use letters, numbers, dashes (-), or underscores (_) for the name.","elementor"),NO_NON_SPECIAL_CHARACTER:(0,d.__)("Names have to include at least one non-special character.","elementor"),VARIABLE_LABEL_MAX_LENGTH:(0,d.__)("Keep names up to 50 characters.","elementor"),DUPLICATED_LABEL:(0,d.__)("This variable name already exists. Please choose a unique name.","elementor"),UNEXPECTED_ERROR:(0,d.__)("There was a glitch. Try saving your variable again.","elementor"),BATCH:{DUPLICATED_LABELS:(e,t)=>(0,d.sprintf)((0,d.__)("We found %1$d duplicated %2$s.","elementor"),e,t),UNEXPECTED_ERROR:(0,d.__)("There was a glitch.","elementor"),DUPLICATED_LABEL_ACTION:(0,d.__)("Take me there","elementor"),DUPLICATED_LABEL_ACTION_MESSAGE:(0,d.__)("Please rename the variables.","elementor"),UNEXPECTED_ERROR_ACTION_MESSAGE:(0,d.__)("Try saving your variables again.","elementor")}},v=e=>{if("duplicated_label"===e?.response?.data?.code)return{field:"label",message:h.DUPLICATED_LABEL};if("batch_duplicated_label"===e?.response?.data?.code){const t=e?.response?.data?.data??{},a=Object.keys(t).length,n=1===a?"name":"names",r=Object.keys(t);return{field:"label",message:h.BATCH.DUPLICATED_LABELS(a,n),severity:"error",IconComponent:c.AlertTriangleFilledIcon,action:{label:h.BATCH.DUPLICATED_LABEL_ACTION,message:h.BATCH.DUPLICATED_LABEL_ACTION_MESSAGE,data:{duplicatedIds:r}}}}return"batch_operation_failed"===e?.response?.data?.code?{field:"label",message:h.BATCH.UNEXPECTED_ERROR,severity:"secondary",IconComponent:c.InfoCircleFilledIcon,action:{message:h.BATCH.UNEXPECTED_ERROR_ACTION_MESSAGE}}:void 0},g=e=>39<e.length?h.VARIABLE_LABEL_MAX_LENGTH:"",y=e=>e.trim()?"":h.MISSING_VARIABLE_VALUE;var E=window.elementorV2.editorCanvas;const f=(0,u.styled)(u.UnstableColorIndicator)(({theme:e})=>({borderRadius:e.shape.borderRadius/2+"px",marginRight:e.spacing(.25)}));var C=window.elementorV2.schema;const w=(0,o.createPropUtils)("global-color-variable",C.z.string());var _=window.elementorV2.httpClient;const T="elementor/v1/variables",S=e=>e.startsWith("tmp-"),k="elementor-global-variables",I="elementor-global-variables-watermark",x="RW",P=(0,o.createPropUtils)("global-font-variable",C.z.string()),A=(()=>{const e={};let t;const a=(t,a)=>!(t in e)||e[t].label!==a.label||e[t].value!==a.value||!(e[t]?.deleted||!a?.deleted)||!(!e[t]?.deleted||a?.deleted),n=e=>{if(e)try{((e,t="preview")=>{const a=window;a.elementor?.helpers?.enqueueFont?.(e,t)})(e)}catch{}};return{subscribe:e=>(t=e,()=>{t=()=>{}}),update:r=>{(t=>{let r=!1;for(const[o,l]of Object.entries(t))a(o,l)&&(e[o]=l,l.type===P.key&&n(l.value),r=!0);return r})(r)&&"function"==typeof t&&t({...e})}}})(),V=new class{notifyChange(){window.dispatchEvent(new Event("variables:updated"))}constructor(){this.state={watermark:-1,variables:{}}}load(){return this.state.watermark=parseInt(localStorage.getItem(I)||"-1"),this.state.variables=JSON.parse(localStorage.getItem(k)||"{}"),this.state.variables}fill(e,t){this.state.variables={},e&&Object.keys(e).length&&(this.state.variables=e),this.state.watermark=t,localStorage.setItem(I,this.state.watermark.toString()),localStorage.setItem(k,JSON.stringify(this.state.variables)),this.notifyChange()}add(e,t){this.load(),this.state.variables[e]=t,localStorage.setItem(k,JSON.stringify(this.state.variables)),this.notifyChange()}update(e,t){this.load(),this.state.variables[e]=t,localStorage.setItem(k,JSON.stringify(this.state.variables)),this.notifyChange()}watermark(e){this.state.watermark=e,localStorage.setItem(I,this.state.watermark.toString())}watermarkDiff(e,t){const a=t-this.state.watermark;return x===e?1!==a:"RO"===e&&0!==a}},O={variables:()=>V.load(),getWatermark:()=>V.state.watermark,init:()=>O.load(),load:()=>(0,_.httpService)().get(T+"/list").then(e=>{const{success:t,data:a}=e.data;if(!t)throw new Error("Unexpected response from server");return a}).then(e=>{const{variables:t,watermark:a}=e;return V.fill(t,a),A.update(t),t}),create:({type:e,label:t,value:a})=>((e,t,a)=>(0,_.httpService)().post(T+"/create",{type:e,label:t,value:a}))(e,t,a).then(e=>{const{success:t,data:a}=e.data;if(!t){const e=a?.message||(0,d.__)("Unexpected response from server","elementor");throw new Error(e)}return a}).then(e=>{const{variable:t,watermark:a}=e;B(x,a);const{id:n,...r}=t;return V.add(n,r),A.update({[n]:r}),{id:n,variable:r}}),update:(e,{label:t,value:a})=>((e,t,a)=>(0,_.httpService)().put(T+"/update",{id:e,label:t,value:a}))(e,t,a).then(e=>{const{success:t,data:a}=e.data;if(!t){const e=a?.message||(0,d.__)("Unexpected response from server","elementor");throw new Error(e)}return a}).then(e=>{const{variable:t,watermark:a}=e;B(x,a);const{id:n,...r}=t;return V.update(n,r),A.update({[n]:r}),{id:n,variable:r}}),delete:e=>(e=>(0,_.httpService)().post(T+"/delete",{id:e}))(e).then(e=>{const{success:t,data:a}=e.data;if(!t)throw new Error("Unexpected response from server");return a}).then(e=>{const{variable:t,watermark:a}=e;B(x,a);const{id:n,...r}=t;return V.update(n,r),A.update({[n]:r}),{id:n,variable:r}}),restore:(e,t,a)=>((e,t,a)=>{const n={id:e};return t&&(n.label=t),a&&(n.value=a),(0,_.httpService)().post(T+"/restore",n)})(e,t,a).then(e=>{const{success:t,data:a}=e.data;if(!t)throw new Error("Unexpected response from server");return a}).then(e=>{const{variable:t,watermark:a}=e;B(x,a);const{id:n,...r}=t;return V.update(n,r),A.update({[n]:r}),{id:n,variable:r}}),batchSave:(e,t)=>{const a=((e,t)=>{const a=[];return Object.entries(t).forEach(([t,n])=>{if(S(t))a.push({type:"create",variable:{...n,id:t}});else if(e[t]){const r=e[t];r.deleted&&!n.deleted?a.push({type:"restore",id:t,...r.label!==n.label&&{label:n.label},...r.value!==n.value&&{value:n.value}}):n.deleted||r.label===n.label&&r.value===n.value&&r.order===n.order||a.push({type:"update",id:t,variable:{...r.label!==n.label&&{label:n.label},...r.value!==n.value&&{value:n.value},...r.order!==n.order&&{order:n.order}}})}}),Object.entries(e).forEach(([e,n])=>{if(S(e)||n.deleted)return;const r=t[e];r&&!r.deleted||a.push({type:"delete",id:e})}),a.filter(e=>{const a=e.id||e.variable?.id;return a&&!(S(a)&&t[a]?.deleted)})})(e,t),n={operations:a,watermark:V.state.watermark};return 0===a.length?Promise.resolve({success:!0,watermark:V.state.watermark,operations:0}):(r=n,(0,_.httpService)().post(T+"/batch",r)).then(e=>{const{success:t,data:a}=e.data;if(!t)throw new Error("Unexpected response from server");return a}).then(e=>{const{results:t,watermark:n}=e;return B(x,n),t&&t.forEach(e=>{if(e.variable){const{id:t,...a}=e.variable;"create"===e.type?V.add(t,a):V.update(t,a),A.update({[t]:a})}}),{success:!0,watermark:n,operations:a.length}});var r}},B=(e,t)=>{V.watermarkDiff(e,t)&&setTimeout(()=>O.load(),500),V.watermark(t)},D=(e,t)=>{let a=e,n="";return t&&(n=t.value),t&&!t.deleted&&(a=t.label),a.trim()?n.trim()?`var(--${a}, ${n})`:`var(--${a})`:null},L=(0,E.createTransformer)(e=>{const t=O.variables()[e];if(!t)return l.createElement("span",null,(0,d.__)("Missing variable","elementor"));const a=t.type===w.key,n=D(e,t);return l.createElement(u.Stack,{direction:"row",spacing:.5,sx:{paddingInline:"1px"},alignItems:"center"},a&&l.createElement(f,{size:"inherit",value:t.value}),l.createElement(u.Typography,{variant:"caption",overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"},n))}),R=(0,E.createTransformer)(e=>{const t=O.variables();return t[e]?D(e,t[e]):null}),{registerVariableType:z,getVariableType:F,getVariableTypes:M,hasVariableType:U}=function(){const e={};return{registerVariableType:({icon:t,startIcon:a,valueField:r,propTypeUtil:o,variableType:l,defaultValue:i,selectionFilter:s,valueTransformer:c,fallbackPropTypeUtil:u,isCompatible:d})=>{if(e[o.key])throw new Error(`Variable with key "${o.key}" is already registered.`);var m;d||(d=(e,t)=>"union"===e.kind&&t.type in e.prop_types),e[o.key]={icon:t,startIcon:a,valueField:r,propTypeUtil:o,variableType:l,defaultValue:i,selectionFilter:s,valueTransformer:c,fallbackPropTypeUtil:u,isCompatible:d},m=o.key,E.styleTransformersRegistry.register(m,R),(e=>{n.stylesInheritanceTransformersRegistry.register(e,L)})(o.key)},getVariableType:t=>e[t],getVariableTypes:()=>e,hasVariableType:t=>t in e}}(),j="delete-variable-dialog",N=({open:e,label:t,closeDialog:a,onConfirm:n})=>l.createElement(u.Dialog,{open:e,onClose:a,"aria-labelledby":j,maxWidth:"xs"},l.createElement(u.DialogTitle,{id:j,display:"flex",alignItems:"center",gap:1,sx:{lineHeight:1}},l.createElement(c.AlertOctagonFilledIcon,{color:"error"}),(0,d.__)("Delete this variable?","elementor")),l.createElement(u.DialogContent,null,l.createElement(u.DialogContentText,{variant:"body2",color:"textPrimary"},(0,d.__)("All elements using","elementor")," ",l.createElement(u.Typography,{variant:"subtitle2",component:"span",sx:{lineBreak:"anywhere"}},t)," ",(0,d.__)("will keep their current values, but the variable itself will be removed.","elementor"))),l.createElement(u.DialogActions,null,l.createElement(u.Button,{color:"secondary",onClick:a},(0,d.__)("Not now","elementor")),l.createElement(u.Button,{variant:"contained",color:"error",onClick:n},(0,d.__)("Delete","elementor"))));var W=window.elementorV2.editorCurrentUser;const H=()=>{const{canUser:e}=(0,W.useCurrentUserCapabilities)();return{canAssign:()=>e("edit_posts"),canUnlink:()=>e("edit_posts"),canAdd:()=>e("manage_options"),canDelete:()=>e("manage_options"),canEdit:()=>e("manage_options"),canRestore:()=>e("manage_options"),canManageSettings:()=>e("manage_options")}},$=({icon:e,title:t,message:a,onAdd:n})=>{const r=H().canAdd();return l.createElement(u.Stack,{gap:1,alignItems:"center",justifyContent:"flex-start",height:"100%",color:"text.secondary",sx:{p:2.5,pt:8,pb:5.5}},e,r?l.createElement(l.Fragment,null,l.createElement(G,{title:t,message:a}),n&&l.createElement(u.Button,{variant:"outlined",color:"secondary",size:"small",onClick:n},(0,d.__)("Create a variable","elementor"))):l.createElement(G,{title:(0,d.__)("There are no variables","elementor"),message:(0,d.__)("With your current role, you can only connect and detach variables.","elementor")}))};function G({title:e,message:t}){return l.createElement(l.Fragment,null,l.createElement(u.Typography,{align:"center",variant:"subtitle2"},e),l.createElement(u.Typography,{align:"center",variant:"caption",maxWidth:"180px"},t))}const q=({searchValue:e,onClear:t,icon:a})=>l.createElement(u.Stack,{gap:1,alignItems:"center",justifyContent:"center",p:2.5,color:"text.secondary",sx:{pb:3.5,pt:8}},a,l.createElement(u.Typography,{align:"center",variant:"subtitle2"},(0,d.__)("Sorry, nothing matched","elementor"),l.createElement("br",null),"“",e,"”."),l.createElement(u.Typography,{align:"center",variant:"caption",sx:{display:"flex",flexDirection:"column"}},(0,d.__)("Try something else.","elementor"),l.createElement(u.Link,{color:"text.secondary",variant:"caption",component:"button",onClick:t},(0,d.__)("Clear & try again","elementor"))));var K=window.elementorV2.editorControls;const X=(0,l.createContext)(null);function J({children:e,propTypeKey:t}){return l.createElement(X.Provider,{value:t},e)}function Y(){const e=(0,l.useContext)(X);if(null===e)throw new Error("useVariableType must be used within a VariableTypeProvider");return F(e)}function Z(e,t){const a=t.toLowerCase();return e.filter(e=>e.label.toLowerCase().includes(a))}const Q=(e=!0)=>{const t=O.variables();return e?t:Object.fromEntries(Object.entries(t).filter(([,e])=>!e.deleted))},ee=e=>{const t=Q();return t?.[e]?{...t[e],key:e}:null},te=e=>{const t=Q(!1);return Object.entries(t).filter(([,t])=>t.type===e).map(([e,{label:t,value:a,order:n}])=>({key:e,label:t,value:a,order:n}))},ae=({id:e})=>e,ne=(e,t,a)=>O.restore(e,t,a).then(ae);function re(){return re=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)({}).hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},re.apply(null,arguments)}const oe="tiny",le=({variables:e,onCreate:t,disabled:a,menuState:n})=>{const r=(0,l.useRef)(null),o=M(),i=Object.entries(o).map(([a,n])=>{const r=n.variableType.charAt(0).toUpperCase()+n.variableType.slice(1);return{key:a,name:r,icon:n.icon,onClick:()=>{const r=ie(e,a,n.variableType);t(a,r,n.defaultValue||""),b({action:"add",varType:n.variableType})}}});return l.createElement(l.Fragment,null,l.createElement(u.IconButton,re({},(0,u.bindTrigger)(n),{ref:r,disabled:a,size:oe,"aria-label":(0,d.__)("Add variable","elementor")}),l.createElement(c.PlusIcon,{fontSize:oe})),l.createElement(u.Menu,re({disablePortal:!0,MenuListProps:{dense:!0},PaperProps:{elevation:6}},(0,u.bindMenu)(n),{anchorEl:r.current,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},"data-testid":"variable-manager-create-menu"}),i.map(e=>l.createElement(u.MenuItem,{key:e.key,onClick:()=>{e.onClick?.(),n.close()},sx:{gap:1.5}},(0,l.createElement)(e.icon,{fontSize:oe,color:"action"}),l.createElement(u.Typography,{variant:"caption",color:"text.primary"},e.name)))))},ie=(e,t,a)=>{const n=Object.values(e).filter(e=>e.type===t).map(e=>e.label);let r=1,o=`${a}-${r}`;for(;n.includes(o);)r++,o=`${a}-${r}`;return o};function se(){return se=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)({}).hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},se.apply(null,arguments)}function ce(e,t){return e.trim().toLowerCase()===t.trim().toLowerCase()}const ue=e=>{const[t,a]=(0,l.useState)(e??{value:"",message:""});return{labelFieldError:t,setLabelFieldError:a}},de=({value:e,error:t,onChange:a,id:n,onErrorChange:r,size:o="tiny",focusOnShow:s=!1,selectOnShow:c=!1,showWarningInfotip:d=!1,variables:m})=>{const[p,b]=(0,l.useState)(e),[v,y]=(0,l.useState)(""),E=(0,l.useRef)(null);let f=v;ce(p,t?.value??"")&&t?.message&&(f=t.message);const C=f?"":g(p),w=l.createElement(u.TextField,{ref:E,id:n,size:o,fullWidth:!0,value:p,error:!!f,onChange:e=>(e=>{b(e);const n=((e,t)=>e.trim()?/^[a-zA-Z0-9_-]+$/.test(e)?/[a-zA-Z0-9]/.test(e)?50<e.length?h.VARIABLE_LABEL_MAX_LENGTH:Object.values(t??{}).some(t=>t.label===e)?h.DUPLICATED_LABEL:"":h.NO_NON_SPECIAL_CHARACTER:h.INVALID_CHARACTERS:h.MISSING_VARIABLE_NAME)(e,m);y(n),r?.(n),a(ce(e,t?.value??"")||n?"":e)})(e.target.value),inputProps:{maxLength:50,...c&&{onFocus:e=>e.target.select()},"aria-label":"Name"},autoFocus:s});if(d){const e=Math.max(240,E.current?.getBoundingClientRect().width??240);return l.createElement(i.WarningInfotip,se({open:Boolean(f||C),text:f||C,placement:"bottom-start",width:e,offset:[0,-15]},C&&{hasError:!1}),w)}return w};function me(){return me=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)({}).hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},me.apply(null,arguments)}const pe=({menuActions:e,disabled:t,itemId:a})=>{const n=(0,u.usePopupState)({variant:"popover"});return l.createElement(l.Fragment,null,l.createElement(u.IconButton,me({},(0,u.bindTrigger)(n),{disabled:t,size:"tiny"}),l.createElement(c.DotsVerticalIcon,{fontSize:"tiny"})),l.createElement(u.Menu,me({disablePortal:!0,MenuListProps:{dense:!0},PaperProps:{elevation:6}},(0,u.bindMenu)(n),{anchorEl:n.anchorEl,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},open:n.isOpen,onClose:n.close}),e.map(e=>l.createElement(u.MenuItem,{key:e.name,onClick:()=>{e.onClick?.(a),n.close()},sx:{color:e.color,gap:1}},e.icon&&(0,l.createElement)(e.icon,{fontSize:"inherit"})," ",e.name))))},be=({children:e,isHeader:t,width:a,maxWidth:n,align:r,noPadding:o,sx:i})=>{const s={maxWidth:n??150,cursor:"initial",typography:"caption",...t&&{color:"text.primary",fontWeight:"bold"},...t&&!o&&{padding:"10px 16px"},...a&&{width:a},...i};return l.createElement(u.TableCell,{size:"small",padding:o?"none":void 0,align:r,sx:s},e)},he=l.memo(({initialValue:e,children:t,editableElement:a,onChange:n,prefixElement:r,autoEdit:o=!1,onRowRef:i,onAutoEditComplete:s,gap:c=1,fieldType:d})=>{const[m,p]=(0,l.useState)(e),[b,h]=(0,l.useState)(!1),{labelFieldError:v,setLabelFieldError:g}=ue(),[y,E]=(0,l.useState)(""),f=(0,l.useRef)(null),C=(0,l.useCallback)(()=>{"label"===d&&v?.message||"value"===d&&y||n(m),h(!1)},[m,n,d,v,y]);(0,l.useEffect)(()=>{i?.(f?.current)},[i]),(0,l.useEffect)(()=>{o&&!b&&(h(!0),s?.())},[o,b,s]);const w=()=>{h(!0)},_=e=>{"Enter"===e.key?C():"Escape"===e.key&&h(!1)," "!==e.key||b||(e.preventDefault(),h(!0))},T=(0,l.useCallback)(e=>{p(e)},[]),S=(0,l.useCallback)(e=>{"label"===d?g({value:m,message:e}):E(e)},[d,m,g,E]);let k;"label"===d?k=v:"value"===d&&(k={value:m,message:y});const I=a({value:m,onChange:T,onValidationChange:S,error:k});return b?l.createElement(u.ClickAwayListener,{onClickAway:C},l.createElement(u.Stack,{ref:f,direction:"row",alignItems:"center",gap:c,onDoubleClick:w,onKeyDown:_,tabIndex:0,role:"button","aria-label":"Double click or press Space to edit"},r,I)):l.createElement(u.Stack,{ref:f,direction:"row",alignItems:"center",gap:c,onDoubleClick:w,onKeyDown:_,tabIndex:0,role:"button","aria-label":"Double click or press Space to edit"},r,t)});function ve(){return ve=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)({}).hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},ve.apply(null,arguments)}const ge=({menuActions:e,variables:t,onChange:a,autoEditVariableId:n,onAutoEditComplete:r,onFieldError:o})=>{const s=(0,l.useRef)(null),m=(0,l.useRef)(new Map);(0,l.useEffect)(()=>{if(n&&s.current){const e=m.current.get(n);e&&setTimeout(()=>{e.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})},100)}},[n]);const p=e=>t=>{t?m.current.set(e,t):m.current.delete(e)},b=Object.keys(t).sort(function(e){return(t,a)=>(e[t]?.order??Number.MAX_SAFE_INTEGER)-(e[a]?.order??Number.MAX_SAFE_INTEGER)}(t)),h=b.filter(e=>!t[e].deleted).map(e=>{const a=t[e],n=F(a.type);return{id:e,type:a.type,name:a.label,value:a.value,...n}}),v={minWidth:250,tableLayout:"fixed"};return l.createElement(u.TableContainer,{ref:s,sx:{overflow:"initial"}},l.createElement(u.Table,{sx:v,"aria-label":"Variables manager list with drag and drop reordering",stickyHeader:!0},l.createElement(u.TableHead,null,l.createElement(u.TableRow,null,l.createElement(be,{isHeader:!0,noPadding:!0,width:10,maxWidth:10}),l.createElement(be,{isHeader:!0},(0,d.__)("Name","elementor")),l.createElement(be,{isHeader:!0},(0,d.__)("Value","elementor")),l.createElement(be,{isHeader:!0,noPadding:!0,width:16,maxWidth:16}))),l.createElement(u.TableBody,null,l.createElement(u.UnstableSortableProvider,{value:b,onChange:e=>{const n={...t};e.forEach((e,t)=>{const a=n[e];a&&(n[e]=Object.assign({},a,{order:t+1}))}),a(n)},variant:"static",restrictAxis:!0,dragOverlay:({children:e,...t})=>l.createElement(u.Table,ve({sx:v},t),l.createElement(u.TableBody,null,e))},h.map(s=>l.createElement(u.UnstableSortableItem,{key:s.id,id:s.id,render:({itemProps:d,showDropIndication:m,triggerProps:b,itemStyle:h,triggerStyle:v,isDragged:g,dropPosition:y,setTriggerRef:E,isSorting:f})=>{const C=m&&"before"===y,w=m&&"after"===y;return l.createElement(u.TableRow,ve({},d,{selected:g,sx:{...C&&{"& td, & th":{borderTop:"2px solid",borderTopColor:"primary.main"}},...w&&{"& td, & th":{borderBottom:"2px solid",borderBottomColor:"primary.main"}},'& [role="toolbar"], & [draggable]':{opacity:0},"&:hover, &:focus-within":{backgroundColor:"action.hover",'& [role="toolbar"], & [draggable]':{opacity:1}}},style:{...h,...v}}),l.createElement(be,{noPadding:!0,width:10,maxWidth:10},l.createElement(u.IconButton,ve({size:"small",ref:E},b,{disabled:f,draggable:!0}),l.createElement(c.GripVerticalIcon,{fontSize:"inherit"}))),l.createElement(be,null,l.createElement(he,{initialValue:s.name,onChange:e=>{e!==s.name&&a({...t,[s.id]:{...t[s.id],label:e}})},prefixElement:(0,l.createElement)(s.icon,{fontSize:"inherit"}),editableElement:({value:e,onChange:a,onValidationChange:r,error:i})=>l.createElement(de,{id:"variable-label-"+s.id,size:"tiny",value:e,onChange:a,onErrorChange:e=>{r?.(e),o?.(!!e)},error:i,focusOnShow:!0,selectOnShow:n===s.id,showWarningInfotip:!0,variables:t}),autoEdit:n===s.id,onRowRef:p(s.id),onAutoEditComplete:n===s.id?r:void 0,fieldType:"label"},l.createElement(i.EllipsisWithTooltip,{title:s.name,sx:{border:"4px solid transparent"}},s.name))),l.createElement(be,null,l.createElement(he,{initialValue:s.value,onChange:e=>{e!==s.value&&a({...t,[s.id]:{...t[s.id],value:e}})},editableElement:({value:e,onChange:t,onValidationChange:a,error:n})=>s.valueField({value:e,onChange:t,onValidationChange:e=>{a?.(e),o?.(!!e)},error:n}),onRowRef:p(s.id),gap:.25,fieldType:"value"},s.startIcon&&s.startIcon({value:s.value}),l.createElement(i.EllipsisWithTooltip,{title:s.value,sx:{border:"4px solid transparent",lineHeight:"1",pt:.25}},s.value))),l.createElement(be,{align:"right",noPadding:!0,width:16,maxWidth:16,sx:{paddingInlineEnd:1}},l.createElement(u.Stack,{role:"toolbar",direction:"row",justifyContent:"flex-end"},l.createElement(pe,{menuActions:e,disabled:f,itemId:s.id}))))}}))))))},ye="variables-manager",{panel:Ee,usePanelActions:fe}=(0,r.__createPanel)({id:ye,component:function(){const{close:e}=fe(),{open:t,close:a,isOpen:n}=(0,i.useDialog)(),o=(0,u.usePopupState)({variant:"popover"}),{variables:s,isDirty:m,searchValue:p,isSaveDisabled:h,handleOnChange:g,createVariable:y,handleDeleteVariable:E,handleSave:f,isSaving:C,handleSearch:w,setIsSaving:_,setIsSaveDisabled:T}=(()=>{const[e,t]=(0,l.useState)(()=>Q(!1)),[a,n]=(0,l.useState)([]),[r,o]=(0,l.useState)(!1),[i,s]=(0,l.useState)(!1),[c,u]=(0,l.useState)(!1),[d,m]=(0,l.useState)(""),p=(0,l.useCallback)(a=>{t({...e,...a}),s(!0)},[e]),b=(0,l.useCallback)((e,a,n)=>{const r=`tmp-${Date.now().toString(36)}-${Math.random().toString(36).substring(2,8)}`,o={id:r,label:a.trim(),value:n.trim(),type:e};return t(e=>({...e,[r]:o})),s(!0),r},[]),h=(0,l.useCallback)(e=>{n(t=>[...t,e]),t(t=>({...t,[e]:{...t[e],deleted:!0}})),s(!0)},[]),v=(0,l.useCallback)(async()=>{const a=Q(!1);u(!0);const r=await O.batchSave(a,e);if(r.success){await O.load();const e=O.variables();t(e),n([]),s(!1)}return{success:r.success}},[e]);return{variables:(()=>{const t=Object.entries(e).map(([e,t])=>({...t,id:e})),a=Z(t,d);return Object.fromEntries(a.map(({id:e,...t})=>[e,t]))})(),deletedVariables:a,isDirty:i,isSaveDisabled:r,handleOnChange:p,createVariable:b,handleDeleteVariable:h,handleSave:v,isSaving:c,handleSearch:e=>{m(e)},searchValue:d,setIsSaving:u,setIsSaveDisabled:o}})(),{autoEditVariableId:S,startAutoEdit:k,handleAutoEditComplete:I}=(()=>{const[e,t]=(0,l.useState)(void 0);return{autoEditVariableId:e,startAutoEdit:(0,l.useCallback)(e=>{t(e)},[]),handleAutoEditComplete:(0,l.useCallback)(()=>{setTimeout(()=>{t(void 0)},100)},[])}})(),{createNavigationCallback:x,resetNavigation:P}=(()=>{const e=(0,l.useRef)(0);return{createNavigationCallback:(0,l.useCallback)((t,a,n)=>()=>{if(!t?.length)return;const r=e.current,o=t[r];if(o){a(o);const l=r+1;l>=t.length?(n(),e.current=0):e.current=l}},[]),resetNavigation:(0,l.useCallback)(()=>{e.current=0},[])}})(),[A,V]=(0,l.useState)(null),[B,D]=(0,l.useState)(null);Ce(m);const L=(0,l.useCallback)((e,t,a)=>{const n=y(e,t,a);n&&k(n)},[y,k]),R=async()=>{try{D(null),P();const e=await f();return b({action:"saveChanges"}),e}catch(e){const t=v(e),a=t?.action?.data?.duplicatedIds;return t&&"label"===t.field&&(a&&t.action&&(t.action.callback=x(a,k,()=>{T(!1)})),D(t),T(!0),P()),{success:!1,error:t}}finally{_(!1)}},z=(0,l.useCallback)(e=>{E(e),V(null)},[E]),M=[{name:(0,d.__)("Delete","elementor"),icon:c.TrashIcon,color:"error.main",onClick:e=>{const t=s[e];if(t){V({id:e,label:t.label});const a=F(t.type);b({action:"delete",varType:a?.variableType})}}}],U=Object.values(s).some(e=>!e.deleted);return l.createElement(i.ThemeProvider,null,l.createElement(r.Panel,null,l.createElement(r.PanelHeader,{sx:{height:"unset"}},l.createElement(u.Stack,{width:"100%",direction:"column",alignItems:"center"},l.createElement(u.Stack,{p:1,pl:2,width:"100%",direction:"row",alignItems:"center"},l.createElement(u.Stack,{width:"100%",direction:"row",gap:1},l.createElement(r.PanelHeaderTitle,{sx:{display:"flex",alignItems:"center",gap:.5}},l.createElement(c.ColorFilterIcon,{fontSize:"inherit"}),(0,d.__)("Variables Manager","elementor"))),l.createElement(u.Stack,{direction:"row",gap:.5,alignItems:"center"},l.createElement(le,{onCreate:L,variables:s,menuState:o}),l.createElement(u.CloseButton,{"aria-label":"Close",slotProps:{icon:{fontSize:oe}},onClick:()=>{m?t():e()}}))),l.createElement(u.Stack,{width:"100%",direction:"row",gap:1},l.createElement(i.SearchField,{sx:{display:"flex",flex:1},placeholder:(0,d.__)("Search","elementor"),value:p,onSearch:w})),l.createElement(u.Divider,{sx:{width:"100%"}}))),l.createElement(r.PanelBody,{sx:{display:"flex",flexDirection:"column",height:"100%"}},U&&l.createElement(ge,{menuActions:M,variables:s,onChange:g,autoEditVariableId:S,onAutoEditComplete:I,onFieldError:T}),!U&&p&&l.createElement(q,{searchValue:p,onClear:()=>w(""),icon:l.createElement(c.ColorFilterIcon,{fontSize:"large"})}),!U&&!p&&l.createElement($,{title:(0,d.__)("Create your first variable","elementor"),message:(0,d.__)("Variables are saved attributes that you can apply anywhere on your site.","elementor"),icon:l.createElement(c.ColorFilterIcon,{fontSize:"large"}),onAdd:o.open})),l.createElement(r.PanelFooter,null,l.createElement(u.Infotip,{placement:"right",open:!!B,content:B?l.createElement(u.Alert,{severity:B.severity??"error",action:B.action?.label?l.createElement(u.AlertAction,{onClick:B.action.callback},B.action.label):void 0,onClose:B.action?.label?void 0:()=>{D(null),T(!1)},icon:B.IconComponent?l.createElement(B.IconComponent,null):l.createElement(c.AlertTriangleFilledIcon,null)},l.createElement(u.AlertTitle,null,B.message),B.action?.message):null,arrow:!1,slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[-10,10]}}]}}},l.createElement(u.Button,{fullWidth:!0,size:"small",color:"global",variant:"contained",disabled:h||!m||C,onClick:R,loading:C},(0,d.__)("Save changes","elementor"))))),A&&l.createElement(N,{open:!0,label:A.label,onConfirm:()=>z(A.id),closeDialog:()=>V(null)}),n&&l.createElement(i.SaveChangesDialog,null,l.createElement(i.SaveChangesDialog.Title,{onClose:a},(0,d.__)("You have unsaved changes","elementor")),l.createElement(i.SaveChangesDialog.Content,null,l.createElement(i.SaveChangesDialog.ContentText,null,(0,d.__)("To avoid losing your updates, save your changes before leaving.","elementor"))),l.createElement(i.SaveChangesDialog.Actions,{actions:{discard:{label:(0,d.__)("Discard","elementor"),action:()=>{a(),e()}},confirm:{label:(0,d.__)("Save","elementor"),action:async()=>{const t=await R();a(),t?.success&&e()}}}})))},allowedEditModes:["edit",ye],onOpen:()=>{(0,s.changeEditMode)(ye)},onClose:()=>{(0,s.changeEditMode)("edit")},isOpenPreviousElement:!0}),Ce=e=>{(0,l.useEffect)(()=>{const t=t=>{e&&t.preventDefault()};return window.addEventListener("beforeunload",t),()=>{window.removeEventListener("beforeunload",t)}},[e])};function we(e,t,a){return()=>{const{fallbackPropTypeUtil:n}=F(t),r=function(e,t){const{valueTransformer:a}=F(t);return a?a(e.value):e.value}(e,t);a(n.create(r))}}const _e=(0,l.createContext)(null),Te=({children:e})=>{const[t,a]=(0,l.useState)(null);return l.createElement(_e.Provider,{value:t},l.createElement(u.Box,{ref:a},e))},Se=()=>(0,l.useContext)(_e),ke=()=>{const{propTypeUtil:e}=Y(),t=(0,K.useBoundProp)(e);return{...t,setVariableValue:e=>Ie(e,t),variableId:t.value??t.placeholder}},Ie=(e,t)=>{const a=xe(t.value),n=xe(t.placeholder),r=xe(e);return a||n!==r?t.setValue(e):t.setValue(null)},xe=e=>(0,o.isTransformable)(e)?e.value:e,Pe=({id:e,label:t,errorMsg:a,noticeMsg:n,children:r})=>l.createElement(u.Grid,{container:!0,gap:.75,alignItems:"center"},l.createElement(u.Grid,{item:!0,xs:12},l.createElement(u.FormLabel,{htmlFor:e,size:"tiny"},t)),l.createElement(u.Grid,{item:!0,xs:12},r,a&&l.createElement(u.FormHelperText,{error:!0},a),n&&l.createElement(u.FormHelperText,null,n))),Ae="tiny",Ve=({onGoBack:e,onClose:t})=>{const{icon:a,valueField:r,variableType:o,propTypeUtil:s}=Y(),{setVariableValue:m,path:b}=ke(),{propType:y}=(0,K.useBoundProp)(),E=(()=>{const{value:e}=(0,K.useBoundProp)(),t=U(e?.$$type)&&Boolean(e?.value),a=ee(t?e.value:"");return t?a?a.value:"":e?.value??""})(),[f,C]=(0,l.useState)(E),[w,_]=(0,l.useState)(""),[T,S]=(0,l.useState)(""),[k,I]=(0,l.useState)(""),{labelFieldError:x,setLabelFieldError:P}=ue(),A=()=>{C(""),_(""),S(""),I(""),t()},V=""===w.trim()||("string"==typeof f?""===f.trim():!1===Boolean(f))||!!T;return l.createElement(n.PopoverBody,{height:"auto"},l.createElement(i.PopoverHeader,{icon:l.createElement(l.Fragment,null,e&&l.createElement(u.IconButton,{size:Ae,"aria-label":(0,d.__)("Go Back","elementor"),onClick:e},l.createElement(c.ArrowLeftIcon,{fontSize:Ae})),l.createElement(a,{fontSize:Ae})),title:(0,d.__)("Create variable","elementor"),onClose:A}),l.createElement(u.Divider,null),l.createElement(K.PopoverContent,{p:2},l.createElement(Pe,{id:"variable-label",label:(0,d.__)("Name","elementor"),errorMsg:x?.message,noticeMsg:g(w)},l.createElement(de,{id:"variable-label",value:w,error:x,onChange:e=>{_(e),S("")},onErrorChange:e=>{P({value:w,message:e})}})),l.createElement(Pe,{errorMsg:k,label:(0,d.__)("Value","elementor")},l.createElement(u.Typography,{variant:"h5",id:"variable-value-wrapper"},l.createElement(r,{value:f,onChange:e=>{C(e),S(""),I("")},onValidationChange:I,propType:y}))),T&&l.createElement(u.FormHelperText,{error:!0},T)),l.createElement(u.CardActions,{sx:{pt:.5,pb:1}},l.createElement(u.Button,{id:"create-variable-button",size:"small",variant:"contained",disabled:V,onClick:()=>{var e;(e={value:f,label:w,type:s.key},O.create(e).then(ae)).then(e=>{m(e),A()}).catch(e=>{const t=v(e);if(t&&"label"===t.field)return _(""),void P({value:w,message:t.message});S(h.UNEXPECTED_ERROR)}),p({varType:o,controlPath:b.join("."),action:"save"})}},(0,d.__)("Create","elementor"))))},Oe=({closeDialog:e,onConfirm:t,onSuppressMessage:a})=>{const[n,r]=(0,l.useState)(!1);return l.createElement(u.Dialog,{open:!0,onClose:e,maxWidth:"xs"},l.createElement(u.DialogTitle,{display:"flex",alignItems:"center",gap:1},l.createElement(c.AlertTriangleFilledIcon,{color:"secondary"}),(0,d.__)("Changes to variables go live right away.","elementor")),l.createElement(u.DialogContent,null,l.createElement(u.DialogContentText,{variant:"body2",color:"textPrimary"},(0,d.__)("Don't worry - all other changes you make will wait until you publish your site.","elementor"))),l.createElement(u.DialogActions,{sx:{justifyContent:"space-between",alignItems:"center"}},l.createElement(u.FormControlLabel,{control:l.createElement(u.Checkbox,{checked:n,onChange:e=>r(e.target.checked),size:"small"}),label:l.createElement(u.Typography,{variant:"body2"},(0,d.__)("Don't show me again","elementor"))}),l.createElement("div",null,l.createElement(u.Button,{color:"secondary",onClick:e},(0,d.__)("Keep editing","elementor")),l.createElement(u.Button,{variant:"contained",color:"secondary",onClick:()=>{n&&a?.(),t?.()},sx:{ml:1}},(0,d.__)("Save","elementor")))))},Be="tiny",De=(0,d.__)("Delete variable","elementor"),Le=({onClose:e,onGoBack:t,onSubmit:a,editId:r})=>{const{icon:o,valueField:s,variableType:m}=Y(),{setVariableValue:p,variableId:b}=ke(),{propType:y}=(0,K.useBoundProp)(),[E,f]=(0,W.useSuppressedMessage)("edit-confirmation-dialog"),[C,w]=(0,l.useState)(!1),[_,T]=(0,l.useState)(!1),[S,k]=(0,l.useState)(""),[I,x]=(0,l.useState)(""),{labelFieldError:P,setLabelFieldError:V}=ue(),B=ee(r);if(!B)throw new Error(`Global ${m} variable not found`);const D=H(),[L,R]=(0,l.useState)(()=>B.value),[z,F]=(0,l.useState)(()=>B.label);(0,l.useEffect)(()=>(A.update({[r]:{...B,value:L}}),()=>{A.update({[r]:{...B}})}),[r,L,B]);const M=()=>{((e,{value:t,label:a})=>O.update(e,{value:t,label:a}).then(ae))(r,{value:L,label:z}).then(()=>{U(),a?.()}).catch(e=>{const t=v(e);if(t&&"label"===t.field)return F(""),void V({value:z,message:t.message});k(h.UNEXPECTED_ERROR)})},U=()=>{r===b&&p(r)},j=[];D.canDelete()&&j.push(l.createElement(u.Tooltip,{key:"delete",placement:"top",title:De},l.createElement(u.IconButton,{size:Be,onClick:()=>{w(!0)},"aria-label":De},l.createElement(c.TrashIcon,{fontSize:Be}))));const $=L===B.value&&z===B.label||""===z.trim()||("string"==typeof L?""===L.trim():!1===Boolean(L))||!!S;return l.createElement(l.Fragment,null,l.createElement(n.PopoverBody,{height:"auto"},l.createElement(i.PopoverHeader,{title:(0,d.__)("Edit variable","elementor"),onClose:e,icon:l.createElement(l.Fragment,null,t&&l.createElement(u.IconButton,{size:Be,"aria-label":(0,d.__)("Go Back","elementor"),onClick:t},l.createElement(c.ArrowLeftIcon,{fontSize:Be})),l.createElement(o,{fontSize:Be})),actions:j}),l.createElement(u.Divider,null),l.createElement(K.PopoverContent,{p:2},l.createElement(Pe,{id:"variable-label",label:(0,d.__)("Name","elementor"),errorMsg:P?.message,noticeMsg:g(z)},l.createElement(de,{id:"variable-label",value:z,error:P,onChange:e=>{F(e),k("")},onErrorChange:e=>{V({value:z,message:e})}})),l.createElement(Pe,{errorMsg:I,label:(0,d.__)("Value","elementor")},l.createElement(u.Typography,{variant:"h5"},l.createElement(s,{value:L,onChange:e=>{R(e),k(""),x("")},onValidationChange:x,propType:y}))),S&&l.createElement(u.FormHelperText,{error:!0},S)),l.createElement(u.CardActions,{sx:{pt:.5,pb:1}},l.createElement(u.Button,{size:"small",variant:"contained",disabled:$,onClick:()=>{E?M():T(!0)}},(0,d.__)("Save","elementor")))),C&&l.createElement(N,{open:!0,label:z,onConfirm:()=>{var e;(e=r,O.delete(e).then(ae)).then(()=>{U(),a?.()})},closeDialog:()=>{w(!1)}}),_&&!E&&l.createElement(Oe,{closeDialog:()=>{T(!1)},onConfirm:M,onSuppressMessage:f}))},Re=(0,d.__)("Edit variable","elementor"),ze=({item:e})=>{const t=e.onEdit;return l.createElement(l.Fragment,null,l.createElement(u.ListItemIcon,null,e.icon),l.createElement(u.Box,{sx:{flex:1,minWidth:0,display:"flex",alignItems:"center",gap:1}},l.createElement(i.EllipsisWithTooltip,{title:e.label||e.value,as:u.Typography,variant:"caption",color:"text.primary",sx:{marginTop:"1px",lineHeight:"2"},maxWidth:"50%"}),e.secondaryText&&l.createElement(i.EllipsisWithTooltip,{title:e.secondaryText,as:u.Typography,variant:"caption",color:"text.tertiary",sx:{marginTop:"1px",lineHeight:"1"},maxWidth:"50%"})),!!t&&l.createElement(u.Tooltip,{placement:"top",title:Re},l.createElement(u.IconButton,{sx:{mx:1,opacity:"0"},onClick:a=>{a.stopPropagation(),t(e.value)},"aria-label":Re},l.createElement(c.EditIcon,{color:"action",fontSize:"tiny"}))))},Fe=(0,u.styled)(u.MenuList)(({theme:e})=>({"& > li":{height:32,width:"100%",display:"flex",alignItems:"center"},'& > [role="option"]':{...e.typography.caption,lineHeight:"inherit",padding:e.spacing(.5,1,.5,2),"&:hover, &:focus":{backgroundColor:e.palette.action.hover},'&[aria-selected="true"]':{backgroundColor:e.palette.action.selected},cursor:"pointer",textOverflow:"ellipsis",position:"absolute",top:0,left:0,"&:hover .MuiIconButton-root, .MuiIconButton-root:focus":{opacity:1}},width:"100%",position:"relative"})),Me="tiny",Ue=(0,d.__)("Create variable","elementor"),je=(0,d.__)("Variables Manager","elementor"),Ne=({closePopover:e,onAdd:t,onEdit:a,onSettings:r})=>{const{icon:o,startIcon:s,variableType:m,propTypeUtil:h}=Y(),{value:v,setValue:g,path:y}=ke(),[E,f]=(0,l.useState)(""),{list:C,hasMatches:w,isSourceNotEmpty:_,hasNoCompatibleVariables:T}=((e,t)=>{const a=(o=t,(0,l.useMemo)(()=>te(o),[o])),n=(e=>{const{selectionFilter:t}=Y(),{propType:a}=(0,K.useBoundProp)();return t?t(e,a):e})(a),r=Z(n,e);var o;return{list:r.sort((e,t)=>(e.order??Number.MAX_SAFE_INTEGER)-(t.order??Number.MAX_SAFE_INTEGER)),hasMatches:r.length>0,isSourceNotEmpty:n.length>0,hasNoCompatibleVariables:a.length>0&&0===n.length}})(E,h.key),S=[];if(t&&S.push(l.createElement(u.Tooltip,{key:"add",placement:"top",title:Ue},l.createElement(u.IconButton,{id:"add-variable-button",size:Me,onClick:()=>{t?.(),p({varType:m,controlPath:y.join("."),action:"add"})},"aria-label":Ue},l.createElement(c.PlusIcon,{fontSize:Me})))),r){const e=()=>{r(),b({action:"openManager",varType:m,controlPath:y.join(".")})};S.push(l.createElement(u.Tooltip,{key:"settings",placement:"top",title:je},l.createElement(u.IconButton,{id:"variables-manager-button",size:Me,onClick:e,"aria-label":je},l.createElement(c.SettingsIcon,{fontSize:Me}))))}const k=s||(()=>l.createElement(o,{fontSize:Me})),I=C.map(({value:e,label:t,key:n})=>({type:"item",value:n,label:t,icon:l.createElement(k,{value:e}),secondaryText:e,onEdit:a?()=>a?.(n):void 0})),x=(0,d.sprintf)((0,d.__)("Create your first %s variable","elementor"),m);return l.createElement(n.PopoverBody,null,l.createElement(i.PopoverHeader,{title:(0,d.__)("Variables","elementor"),icon:l.createElement(c.ColorFilterIcon,{fontSize:Me}),onClose:e,actions:S}),_&&l.createElement(i.SearchField,{value:E,onSearch:e=>{f(e)},placeholder:(0,d.__)("Search","elementor")}),l.createElement(u.Divider,null),_&&w&&l.createElement(i.PopoverMenuList,{items:I,onSelect:t=>{g(t),p({varType:m,controlPath:y.join("."),action:"connect"}),e()},onClose:()=>{},selectedValue:v,"data-testid":`${m}-variables-list`,menuListTemplate:Fe,menuItemContentTemplate:e=>l.createElement(ze,{item:e})}),!w&&_&&l.createElement(q,{searchValue:E,onClear:()=>{f("")},icon:l.createElement(o,{fontSize:"large"})}),!_&&!T&&l.createElement($,{title:x,message:(0,d.__)("Variables are saved attributes that you can apply anywhere on your site.","elementor"),icon:l.createElement(o,{fontSize:"large"}),onAdd:t}),T&&l.createElement($,{title:(0,d.__)("No compatible variables","elementor"),message:(0,d.__)("Looks like none of your variables work with this control. Create a new variable to use it here.","elementor"),icon:l.createElement(o,{fontSize:"large"}),onAdd:t}))},We="list",He="edit",$e=({closePopover:e,propTypeKey:t,selectedVariable:a})=>{const[n,r]=(0,l.useState)(We),[o,i]=(0,l.useState)(""),{open:c}=fe(),u=(0,s.isExperimentActive)("e_variables_manager")?()=>{c()}:void 0;return l.createElement(J,{propTypeKey:t},l.createElement(Te,null,function(e){const t=H(),a={onClose:()=>{e.closePopover()},onGoBack:()=>{e.setCurrentView(We)}};t.canAdd()&&(a.onAdd=()=>{e.setCurrentView("add")}),t.canEdit()&&(a.onEdit=t=>{e.setEditId(t),e.setCurrentView(He)}),t.canManageSettings()&&e.onSettings&&(a.onSettings=()=>{e.closePopover(),e.onSettings?.()});return We===e.currentView?l.createElement(Ne,{closePopover:a.onClose,onAdd:a.onAdd,onEdit:a.onEdit,onSettings:a.onSettings}):"add"===e.currentView?l.createElement(Ve,{onGoBack:a.onGoBack,onClose:a.onClose}):He===e.currentView?l.createElement(Le,{editId:e.editId,onGoBack:a.onGoBack,onClose:a.onClose,onSubmit:()=>{e?.selectedVariable?.key===e.editId?a.onClose():a.onGoBack?.()}}):null}({propTypeKey:t,currentView:n,selectedVariable:a,editId:o,setEditId:i,setCurrentView:r,closePopover:e,onSettings:u})))};function Ge(){return Ge=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)({}).hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},Ge.apply(null,arguments)}const qe="tiny",Ke=(0,d.__)("Unlink variable","elementor"),Xe=({startIcon:e,label:t,onUnlink:a,...n})=>{const r=[];return a&&r.push(l.createElement(u.Tooltip,{key:"unlink",title:Ke,placement:"bottom"},l.createElement(u.IconButton,{size:qe,onClick:a,"aria-label":Ke},l.createElement(c.DetachIcon,{fontSize:qe})))),l.createElement(u.Tooltip,{title:t,placement:"top"},l.createElement(u.UnstableTag,Ge({fullWidth:!0,showActionsOnHover:!0,startIcon:l.createElement(u.Stack,{gap:.5,direction:"row",alignItems:"center"},e),label:l.createElement(u.Box,{sx:{display:"inline-grid",minWidth:0}},l.createElement(u.Typography,{sx:{lineHeight:1.34},variant:"caption",noWrap:!0},t)),actions:r},n)))};function Je(){return Je=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)({}).hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},Je.apply(null,arguments)}const Ye=({variable:e,propTypeKey:t})=>{const{startIcon:a,propTypeUtil:n}=F(t),{setValue:r}=(0,K.useBoundProp)(),o=(0,l.useRef)(null),i=(0,l.useId)(),s=(0,u.usePopupState)({variant:"popover",popupId:`elementor-variables-list-${i}`}),d=we(e,t,r),m=a||(()=>null);return l.createElement(u.Box,{ref:o},l.createElement(Xe,Je({label:e.label,startIcon:l.createElement(l.Fragment,null,l.createElement(c.ColorFilterIcon,{fontSize:qe}),l.createElement(m,{value:e.value})),onUnlink:d},(0,u.bindTrigger)(s))),l.createElement(u.Popover,Je({disableScrollLock:!0,anchorEl:o.current,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},PaperProps:{sx:{my:1}}},(0,u.bindPopover)(s)),l.createElement($e,{selectedVariable:e,closePopover:s.close,propTypeKey:n.key})))},Ze=({variableId:e,onClose:t,onSubmit:a})=>{const{icon:r,valueField:o,variableType:s}=Y(),{setVariableValue:c}=ke(),{propType:m}=(0,K.useBoundProp)(),p=ee(e);if(!p)throw new Error(`Global ${s} variable not found`);const[b,y]=(0,l.useState)(""),[E,f]=(0,l.useState)(""),[C,w]=(0,l.useState)(p.label),[_,T]=(0,l.useState)(p.value),{labelFieldError:S,setLabelFieldError:k}=ue({value:p.label,message:h.DUPLICATED_LABEL}),I=_===p.value&&C===p.label||""===C.trim()||("string"==typeof _?""===_.trim():!1===Boolean(_))||!!b;return l.createElement(Te,null,l.createElement(n.PopoverBody,{height:"auto"},l.createElement(i.PopoverHeader,{icon:l.createElement(r,{fontSize:"tiny"}),title:(0,d.__)("Restore variable","elementor"),onClose:t}),l.createElement(u.Divider,null),l.createElement(K.PopoverContent,{p:2},l.createElement(Pe,{id:"variable-label",label:(0,d.__)("Name","elementor"),errorMsg:S?.message,noticeMsg:g(C)},l.createElement(de,{id:"variable-label",value:C,error:S,onChange:e=>{w(e),y("")},onErrorChange:e=>{k({value:C,message:e})}})),l.createElement(Pe,{errorMsg:E,label:(0,d.__)("Value","elementor")},l.createElement(u.Typography,{variant:"h5"},l.createElement(o,{value:_,onChange:e=>{T(e),y(""),f("")},onValidationChange:f,propType:m}))),b&&l.createElement(u.FormHelperText,{error:!0},b)),l.createElement(u.CardActions,{sx:{pt:.5,pb:1}},l.createElement(u.Button,{size:"small",variant:"contained",disabled:I,onClick:()=>{ne(e,C,_).then(()=>{c(e),a?.()}).catch(e=>{const t=v(e);if(t&&"label"===t.field)return w(""),void k({value:C,message:t.message});y(h.UNEXPECTED_ERROR)})}},(0,d.__)("Restore","elementor")))))},Qe=({onClose:e,onUnlink:t,onRestore:a,label:n})=>l.createElement(u.ClickAwayListener,{onClickAway:e},l.createElement(u.Alert,{variant:"standard",severity:"warning",onClose:e,action:l.createElement(l.Fragment,null,t&&l.createElement(u.AlertAction,{variant:"contained",onClick:t},(0,d.__)("Unlink","elementor")),a&&l.createElement(u.AlertAction,{variant:"outlined",onClick:a},(0,d.__)("Restore","elementor"))),sx:{maxWidth:300}},l.createElement(u.AlertTitle,null,(0,d.__)("Deleted variable","elementor")),l.createElement(u.Typography,{variant:"body2",color:"textPrimary"},(0,d.__)("The variable","elementor")," '",l.createElement(u.Typography,{variant:"body2",component:"span",sx:{lineBreak:"anywhere"}},n),"' ",(0,d.__)("has been deleted, but it is still referenced in this location. You may restore the variable or unlink it to assign a different value.","elementor"))));function et(){return et=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)({}).hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},et.apply(null,arguments)}const tt=l.forwardRef(({label:e,suffix:t,onClick:a,icon:n,...r},o)=>{const i=t?`${e} (${t})`:e;return l.createElement(u.Chip,et({ref:o,size:"tiny",color:"warning",shape:"rounded",variant:"standard",onClick:a,icon:l.createElement(c.AlertTriangleFilledIcon,null),label:l.createElement(u.Tooltip,{title:i,placement:"top"},l.createElement(u.Box,{sx:{display:"inline-grid",minWidth:0}},l.createElement(u.Typography,{variant:"caption",noWrap:!0,sx:{lineHeight:1.34}},i))),sx:{height:e=>e.spacing(3.5),borderRadius:e=>e.spacing(1),justifyContent:"flex-start",width:"100%"}},r))});function at(){return at=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)({}).hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},at.apply(null,arguments)}tt.displayName="WarningVariableTag";const nt=({variable:e,propTypeKey:t})=>{const{propTypeUtil:a}=F(t),n=(0,K.useBoundProp)(),r=H(),[o,i]=(0,l.useState)(!1),s=()=>i(!1),c=(0,l.useRef)(null),m=(0,l.useId)(),p=(0,u.usePopupState)({variant:"popover",popupId:`elementor-variables-restore-${m}`}),b={};return r.canUnlink()&&(b.onUnlink=we(e,t,n.setValue)),r.canRestore()&&(b.onRestore=()=>{e.key&&ne(e.key).then(e=>{Ie(a.create(e),n),s()}).catch(()=>{s(),p.setAnchorEl(c.current),p.open()})}),l.createElement(l.Fragment,null,l.createElement(u.Box,{ref:c},o&&l.createElement(u.Backdrop,{open:!0,onClick:s,invisible:!0}),l.createElement(u.Infotip,{color:"warning",placement:"right-start",open:o,disableHoverListener:!0,onClose:s,content:l.createElement(Qe,{onClose:s,onUnlink:b.onUnlink,onRestore:b.onRestore,label:e.label}),slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[0,24]}}]}}},l.createElement(tt,{label:e.label,onClick:()=>i(e=>!e),suffix:(0,d.__)("deleted","elementor")})),l.createElement(u.Popover,at({disableScrollLock:!0,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},PaperProps:{sx:{my:1}}},(0,u.bindPopover)(p)),l.createElement(J,{propTypeKey:t},l.createElement(Ze,{variableId:e.key??"",onClose:p.close,onSubmit:()=>{p.close()}})))))},rt={title:(0,d.__)("Variable has changed","elementor"),message:(0,d.__)("This variable is no longer compatible with this property. You can clear it or select a different one.","elementor"),buttons:{clear:(0,d.__)("Clear","elementor"),select:(0,d.__)("Select variable","elementor")}},ot=({onClose:e,onClear:t,triggerSelect:a})=>l.createElement(u.ClickAwayListener,{onClickAway:e},l.createElement(u.Alert,{variant:"standard",severity:"warning",onClose:e,action:l.createElement(l.Fragment,null,t&&l.createElement(u.AlertAction,{variant:"contained",onClick:t},rt.buttons.clear),a&&l.createElement(u.AlertAction,{variant:"outlined",onClick:a},rt.buttons.select)),sx:{maxWidth:300}},l.createElement(u.AlertTitle,null,rt.title),l.createElement(u.Typography,{variant:"body2",color:"textPrimary"},rt.message)));function lt(){return lt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)({}).hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},lt.apply(null,arguments)}const it=({variable:e})=>{const{setValue:t,value:a}=(0,K.useBoundProp)(),n=(0,l.useRef)(null),r=(0,l.useId)(),o=(0,u.usePopupState)({variant:"popover",popupId:`elementor-variables-list-${r}`}),[i,s]=(0,l.useState)(!1),c=()=>s(!1),m=!!a;return l.createElement(u.Box,{ref:n},i&&l.createElement(u.Backdrop,{open:!0,onClick:c,invisible:!0}),l.createElement(u.Infotip,{color:"warning",placement:"right-start",open:i,disableHoverListener:!0,onClose:c,content:l.createElement(ot,{onClose:c,onClear:m?()=>{c(),t(null)}:void 0,triggerSelect:()=>{c(),o.setAnchorEl(n.current),o.open()}}),slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[0,24]}}]}}},l.createElement(tt,{label:e.label,onClick:()=>s(e=>!e),suffix:(0,d.__)("changed","elementor")})),l.createElement(u.Popover,lt({disableScrollLock:!0,anchorEl:n.current,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},PaperProps:{sx:{my:1}}},(0,u.bindPopover)(o)),l.createElement($e,{selectedVariable:e,closePopover:o.close,propTypeKey:e.type})))},st=({onClose:e,onClear:t})=>l.createElement(u.ClickAwayListener,{onClickAway:e},l.createElement(u.Alert,{variant:"standard",severity:"warning",onClose:e,action:l.createElement(l.Fragment,null,t&&l.createElement(u.AlertAction,{variant:"contained",onClick:t},(0,d.__)("Clear","elementor"))),sx:{maxWidth:300}},l.createElement(u.AlertTitle,null,(0,d.__)("This variable is missing","elementor")),l.createElement(u.Typography,{variant:"body2",color:"textPrimary"},(0,d.__)("It may have been deleted. Try clearing this field and select a different value or variable.","elementor")))),ct=()=>{const{setValue:e}=(0,K.useBoundProp)(),[t,a]=(0,l.useState)(!1),n=()=>a(!1);return l.createElement(l.Fragment,null,t&&l.createElement(u.Backdrop,{open:!0,onClick:n,invisible:!0}),l.createElement(u.Infotip,{color:"warning",placement:"right-start",open:t,disableHoverListener:!0,onClose:n,content:l.createElement(st,{onClose:n,onClear:()=>e(null)}),slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[0,24]}}]}}},l.createElement(tt,{label:(0,d.__)("Missing variable","elementor"),onClick:()=>a(e=>!e)})))},ut=()=>{const e=(0,K.useBoundProp)(),t=e.value??e.placeholder,a=ee(t?.value);if(!a)return l.createElement(ct,null);const{$$type:n}=t;if(a?.deleted)return l.createElement(nt,{variable:a,propTypeKey:n});const{isCompatible:r}=F(a.type);return r&&!r(e?.propType,a)?l.createElement(it,{variable:a}):l.createElement(Ye,{variable:a,propTypeKey:n})},dt=()=>{const{propType:e,path:t}=(0,n.useBoundProp)(),a=mt(e);return{visible:Boolean(a),icon:c.ColorFilterIcon,title:(0,d.__)("Variables","elementor"),content:({close:e})=>a?(pt(t,a.variableType),l.createElement($e,{closePopover:e,propTypeKey:a.propTypeUtil.key})):null}},mt=e=>{if("union"===e.kind)for(const t of Object.keys(e.prop_types)){const e=F(t);if(e)return e}},pt=(e,t)=>{p({varType:t,controlPath:e.join("."),action:"open"})};var bt=window.elementorV2.editorMcp;const ht={type:C.z.string().describe('The type of the variable. Example values: "global-color-variable" or "global-font-variable".'),label:C.z.string().describe("The label of the variable, displayed to the user"),value:C.z.string().describe("The value of the variable, should correspond to the type")},vt={status:C.z.enum(["ok","error"]).describe("The status of the operation"),message:C.z.string().optional().describe("Optional message providing additional information about the operation")},gt=()=>{(0,bt.getMCPByDomain)("variables").addTool({name:"create-global-variable",schema:ht,outputSchema:vt,description:'Create a new global variable\n## When to use this tool:\n- When a user requests to create a new global variable in the Elementor editor.\n- When you need to add a new variable to be used in the editor.\n\n## Prequisites:\n- Ensure you have the most up-to-date list of existing global variables to avoid label duplication. You can use the "list-global-variables" tool to fetch the current variables.\n- Make sure when creating a new variable, the label is unique and not already in use.\n- If the user does not provide a label, ask them to provide one before proceeding.\n- If the user does not provide a type, ask them to provide one before proceeding.\n- If the user does not provide a value, ask them to provide one before proceeding.\n\n## Required parameters:\n- type: The type of the variable. Possible values are \'global-color-variable\' or \'global-font-variable\'.\n- label: The label of the variable, displayed to the user. Must be unique and not already in use.\n- value: The value of the variable. For color variables, this should be a valid CSS color (e.g., \'rgb(255,0,0)\', \'#ff0000\', \'red\'). For font variables, this should be a valid font family (e.g., \'Arial\', \'serif\').\n\n## Example tool call (JSON format):\n```json\n{ "type": "global-color-variable", "label": "My Cool Color", "value": "rgb(1,2,3)" }\n```\n\n## Example tool response (JSON format):\n```json\n{ "status": "ok" }\n```\n\n## Example to a failed tool response, which must be displayed to the end user. If the error message is not plain, attempt to find the most useful part of the message and display it.\n{ "status": "error", "message": "Unsupported type \'global-kuku-variable\'" }\n\nIn that case, inform the user the type is unsupported and they should try another type, perhaps consult to online documentation.\n',handler:async e=>{const{type:t,label:a,value:n}=e;try{await O.create({type:t,label:a,value:n})}catch(e){return{status:"error",message:`There was an error creating the variable: ${e.message||"Unknown server error"}`}}return{status:"ok"}}})},yt=()=>{(0,bt.getMCPByDomain)("variables").addTool({name:"delete-global-variable",schema:{id:C.z.string().describe("The unique identifier of the variable to be deleted.")},outputSchema:{status:C.z.enum(["ok","error"]).describe("The status of the operation")},description:'Delete an existing global variable\n    \n## When to use this tool:\n- When a user requests to delete an existing global variable in the Elementor editor.\n- When you need to remove a variable that is no longer needed or relevant, with the user\'s confirmation.\n\n## Prerequisites:\n- Ensure you have the most up-to-date list of existing global variables. You can use the "list-global-variables" tool to fetch the current variables.\n- Reference the variable by the "id" property, given from the "list-global-variables" tool.\n- Make sure you have the unique identifier of the variable to be deleted before using this tool.\n- Confirm with the user that they want to proceed with the deletion, as this action is irreversible.\n\n<notice>\nA use might reference a variable by it\'s label, but you must always use the unique identifier (id) to delete it.\nIf you only have the label, use the "list-global-variables" tool to find the corresponding id.\n</notice>\n\n<important>\nThis operation is destructive and cannot be undone. Ensure that the user is fully aware of the consequences before proceeding.\nWhen a variable is deleted, all references to it in all pages accross the website will lose their effect.\n</important>',handler:async e=>{const{id:t}=e;try{return await O.delete(t),{status:"ok"}}catch(e){return{status:"error"}}},isDestrcutive:!0})},Et={type:C.z.string().describe("The type of the variable."),label:C.z.string().describe("The label of the variable, displayed to the user"),value:C.z.string().describe("The value of the variable."),id:C.z.string().describe("The unique identifier of the variable. Used for internal reference, not to be exposed to end users")},ft={variables:C.z.array(C.z.object(Et)).describe("List of variables")},Ct=()=>{(0,bt.getMCPByDomain)("variables").addTool({name:"list-global-variables",description:"List editor global variables\n  \n  ## When to use this tool:\n  - When a user requests to see all available global variables in the Elementor editor.\n  - When you need to be exact on a variable label, to avoid any mistakes.\n  - When you want to see the most up-to-date list of global variables.\n  - Before using any other variables related tools that makes changes, such as deletion, creation, or updates. This ensures you have the latest information and there is no naming collision or mismatching.\n  \n  ## Example tool response (JSON format):\n  ```json\n  { variables: [\n   { type: 'global-color-variable', label: 'Cool', value: 'rgb(1,2,3)', id: 'some-unique-id' },\n   { type: 'global-font-variable', label: 'Headline', value: 'serif', id: 'some-other-unique-id' },\n  ] }\n  ```\n  \n  Once you get the response, please display the variables in a user-friendly way, unless explicitly requested otherwise.\n  Unless explicitly requested otherwise, response in HTML Format, prefer to use tables or unordered lists.\n  \n  Note: **The label is most improtant to be seen as-is without any changes.**\n  \n  <important>\n  **Do not omit the label**. This is important for the user to identify the variable.\n  **Do not change the label**, it must be displayed exactly as it is, in it's original characters as received from this tool.\n  </important>\n  ",outputSchema:ft,handler:async()=>{const e=O.variables();return{variables:Object.entries(e).map(([e,t])=>({id:e,...t}))}}})},wt=()=>{(0,bt.getMCPByDomain)("variables").addTool({schema:{id:C.z.string().describe("The unique identifier of the variable to be updated or renamed."),label:C.z.string().describe("The label of the variable to be stored after the change. If the user only wishes to update the value, this must be strictly equal to the current label."),value:C.z.string().describe("The new value for the variable. For color variables, this should be a valid CSS color (e.g., 'rgb(255,0,0)', '#ff0000', 'red'). For font variables, this should be a valid font family (e.g., 'Arial', 'serif'). If the user wishes to rename only, make sure you provide the existing value.")},outputSchema:{status:C.z.enum(["ok","error"]).describe("The status of the operation"),message:C.z.string().optional().describe("Optional message providing additional information about the operation")},name:"update-global-variable",description:'Update an existing global variable\n\n## When to use this tool:\n- When a user requests to update an existing global variable in the Elementor editor.\n- When you need to modify the value of an existing variable.\n- When you want to rename an existing variable (change its label).\n- When you want to both rename and modify the value of an existing variable.\n\n## Prerequisites:\n- Ensure you have the most up-to-date list of existing global variables to avoid label duplication. You can use the "list-global-variables" tool to fetch the current variables.\n- Make sure when updating a variable, the new label is unique and not already in use by another variable.\n- Make sure you understand whether you are updating a value, renaming, or both.\n- Reference the variable by the "id" property, given from the "list-global-variables" tool.\n- If the user wishes to rename, make sure you have the existing value.\n- If the user wishes to update the value, make sure you have to **correct label**.\n- You must have the unique identifier, the current label, the current value, and the new value or label or both, before using this tool.\n\n## Required parameters:\n- id: The unique identifier of the variable to be updated or renamed.\n- label: The label of the variable to be stored after the change. If the user only wishes to update the value, this must be strictly equal to the current label.\n- value: The new value for the variable. For color variables, this should be a valid CSS color (e.g., \'rgb(255,0,0)\', \'#ff0000\', \'red\'). For font variables, this should be a valid font family (e.g., \'Arial\', \'serif\'). If the user wishes to rename only, make sure you provide the existing value.\n\n## Example tool call (JSON format):\n```json\n{ "id": "some-unique-id", "label": "Cool", "value": "rgb(0,140,250)" }\n```\n\n## Example responses (JSON format):\nSuccessful update:\n```json\n{ "status": "ok" }\n```\n\nFailed update, which must be displayed to the end user. If the error message is not plain, attempt to find the most useful part of the message and display it.\n```json\n{ "status": "error", "message": "Label \'Cool\' is already in use by another variable." }\n```\n',handler:async e=>{const{id:t,label:a,value:n}=e;try{return await O.update(t,{label:a,value:n}),{status:"ok"}}catch(e){return{status:"error",message:`There was an error creating the variable: ${e.message||"Unknown server error"}`}}}})},_t="elementor://variables",Tt=()=>{const{mcpServer:e}=(0,bt.getMCPByDomain)("variables");e.resource("global-variables",_t,{description:"Global variables list. Variables are being used in this way: If it is directly in the schema, you need to put the ID which is the key inside the object."},async()=>({contents:[{uri:_t,text:localStorage["elementor-global-variables"]}]})),window.addEventListener("variables:updated",()=>{e.server.sendResourceUpdated({uri:_t,contents:[{uri:_t,text:localStorage["elementor-global-variables"]}]})})},St=({value:e,onChange:t,onValidationChange:a})=>{const[n,r]=(0,l.useState)(e),[o,i]=(0,l.useState)(""),s=(0,l.useRef)(null),c=Se()??s.current;return l.createElement(u.UnstableColorField,{id:"color-variable-field",size:"tiny",fullWidth:!0,value:n,onChange:e=>{r(e);const n=y(e);i(n),a?.(n),t(n?"":e)},error:o||void 0,slotProps:{colorPicker:{anchorEl:c,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:-10},slotProps:{colorIndicator:{size:"inherit",sx:{borderRadius:.5}}}}}})};function kt(){return kt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)({}).hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},kt.apply(null,arguments)}const It=({value:e,onChange:t,onValidationChange:a})=>{const[r,o]=(0,l.useState)(e),i=(0,l.useRef)(null),s=Se()??i.current,m=(0,u.usePopupState)({variant:"popover"}),p=(0,n.useFontFamilies)(),b=(0,n.useSectionWidth)(),h=l.useMemo(()=>p.map(({label:e,fonts:t})=>({label:e,items:t})),[p]),v=(0,l.useId)();return l.createElement(l.Fragment,null,l.createElement(u.UnstableTag,kt({id:v,variant:"outlined",label:r,endIcon:l.createElement(c.ChevronDownIcon,{fontSize:"tiny"})},(0,u.bindTrigger)(m),{fullWidth:!0})),l.createElement(u.Popover,kt({disablePortal:!0,disableScrollLock:!0,anchorEl:s,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:-28}},(0,u.bindPopover)(m)),l.createElement(K.ItemSelector,{id:"font-family-variables-selector",itemsList:h,selectedItem:r,onItemChange:e=>{(e=>{o(e);const n=y(e);a?.(n),t(n?"":e)})(e),m.close()},onClose:m.close,sectionWidth:b,title:(0,d.__)("Font family","elementor"),itemStyle:e=>({fontFamily:e.value}),onDebounce:K.enqueueFont,icon:c.TextIcon})))};function xt(){z({valueField:St,icon:c.BrushIcon,propTypeUtil:w,fallbackPropTypeUtil:o.colorPropTypeUtil,variableType:"color",startIcon:({value:e})=>l.createElement(f,{size:"inherit",component:"span",value:e}),defaultValue:"#ffffff"}),z({valueField:It,icon:c.TextIcon,propTypeUtil:P,fallbackPropTypeUtil:o.stringPropTypeUtil,variableType:"font",defaultValue:"Roboto"})}const Pt="body";function At(){const e=(0,s.__privateUseListenTo)((0,s.commandEndEvent)("editor/documents/attach-preview"),()=>function(){const e=window;return e.elementor?.$preview?.[0]?.contentDocument}()?.head),t=function(){const[e,t]=(0,l.useState)({});return(0,l.useEffect)(()=>{const e=A.subscribe(t);return()=>{e()}},[]),e}(),a=Object.keys(t).length>0;if(!e||!a)return null;const n=(r=t,Object.entries(r).map(([e,t])=>function(e,t){return`--${t?.deleted?e:t.label}:${t.value};`}(e,t)).join(""));var r;const o=`${Pt}{${n}}`;return l.createElement(u.Portal,{container:e},l.createElement("style",{"data-e-style-id":"e-variables",key:o},o))}const Vt=e=>{const t=e?.value?.color?.value;return ee(t||"")},Ot=({value:e})=>{const t=Vt(e);return l.createElement(f,{component:"span",size:"inherit",value:t?.value})},Bt=({value:e})=>{const t=Vt(e);return l.createElement("span",null,t?.label)},Dt=({value:e})=>{const t=Vt(e);return l.createElement(f,{component:"span",size:"inherit",value:t?.value})},Lt=e=>!!w.isValid(e),{registerPopoverAction:Rt}=n.controlActionsMenu;function zt(){xt(),(0,K.injectIntoRepeaterItemIcon)({id:"color-variables-background-icon",component:Ot,condition:({value:e})=>Lt(o.backgroundColorOverlayPropTypeUtil.extract(e)?.color)}),(0,K.injectIntoRepeaterItemIcon)({id:"color-variables-icon",component:Dt,condition:({value:e})=>Lt(o.shadowPropTypeUtil.extract(e)?.color)}),(0,K.injectIntoRepeaterItemLabel)({id:"color-variables-label",component:Bt,condition:({value:e})=>Lt(o.backgroundColorOverlayPropTypeUtil.extract(e)?.color)}),(0,n.registerControlReplacement)({component:ut,condition:({value:e,placeholder:t})=>!!Ft(e)||!e&&Ft(t)}),Rt({id:"variables",useProps:dt}),O.init().then(()=>{!function(){const{setMCPDescription:e}=(0,bt.getMCPByDomain)("variables");e("Elementor Editor Variables MCP"),Ct(),gt(),wt(),yt(),Tt()}()}),(0,a.injectIntoTop)({id:"canvas-style-variables-render",component:At}),(0,r.__registerPanel)(Ee)}function Ft(e){return!!(0,o.isTransformable)(e)&&U(e.$$type)}(window.elementorV2=window.elementorV2||{}).editorVariables=t}(),window.elementorV2.editorVariables?.init?.();